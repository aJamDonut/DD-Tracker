{
    "name": "Draw Load File",
    "codename": "drawLoadFile",
    "value": "0",
    "quantity": "0",
    "credits_shop_item": "0",
    "type": "component_displays",
    "color": "#202327",
    "editedtime": "1680140273",
    "vars": {
        "options": "'loadFile, type=new|load, slot'",
        "getElement": "function(options) {\r\n\r\n  if (!options) {\r\n    options = {\r\n    \tloadFile: {\r\n        \tdate: Date.now(),\r\n          \tname: \"Some name\"\r\n        }\r\n    };\r\n  }\r\n\r\n  if (!options.type) {\r\n    options.type = 'load';\r\n  }\r\n\r\n  if (options.loadFile && options.loadFile.date) {\r\n    if (options.type == 'new') {\r\n      options.type = 'overwrite';\r\n    }\r\n  }\r\n\r\n\r\n\r\n  var typeTitles = {\r\n    new: 'Start',\r\n    overwrite: 'Load',\r\n    load: 'Load',\r\n  }\r\n\r\n  var title = typeTitles[options.type];\r\n\r\n  var file = options.loadFile;\r\n\r\n  if (!file.date) {\r\n    file = undefined;\r\n  } else {\r\n    file.date = new Date(file.date);\r\n  }\r\n\r\n  var w = options.w || 450;\r\n  var pane = game.render.componentRaw('drawBoxPane', { moveable: false, showX: false, w: w, h: 75 });\r\n\r\n  var container = new UIContainer();\r\n  pane.addChild(container);\r\n  container.x = 30;\r\n  container.y = 10;\r\n  if (file) {\r\n    var text = game.render.text(file.name+\"\\nLast save: \" + file.date.toLocaleDateString() + \" \" + file.date.toLocaleTimeString(), 'ingame-label');\r\n  } else {\r\n    var text = game.render.text(\"No save present\", 'ingame-label');\r\n  }\r\n  text.y = 10;\r\n  text.x = 0;\r\n  container.addChild(text);\r\n\r\n  if (options.type == 'load') {\r\n    \/\/Load button\r\n    if (file) {\r\n      var btn = game.render.component('hud_button', { name: title });\r\n      container.addChild(btn);\r\n      btn.x = w - btn.width - 50;\r\n      btn.y = 9;\r\n      btn.isInteractive();\r\n      btn.options = options;\r\n      btn.on('pointerup', function () {\r\n\r\n\r\n        game.loading = true;\r\n        \r\n        if(game.index.getIndex('open_components')['frontMenu']) {\r\n          game.index.getIndex('open_components')['frontMenu'].destroy();\r\n        }\r\n\r\n        let index = window.location.pathname.substring(window.location.pathname.lastIndexOf('\/')+1);\r\n\r\n        let saveFile = game.grid.saveGames[this.options.slot];\r\n\r\n        let x = Math.abs(Math.ceil((saveFile.player.x \/ 64) \/ 10));\r\n        let y = Math.abs(Math.ceil((saveFile.player.y \/ 64) \/ 10));\r\n\r\n        window.location.href = index + `?x=${x}&y=${y}&test=true&type=component&unit=component_loadfile&map=live&load=${this.options.slot}`;\r\n\r\n\r\n        \/*setTimeout(()=>{\r\n        \r\n\r\n          \r\n          console.log(\"Load\", this.options); \/\/Load game\r\n          \r\n          game.slot = this.options.slot;\r\n          var saveFile = game.grid.saveGames[game.slot]\r\n\r\n          game.render.viewport.x = saveFile.viewport.x;\r\n          game.render.viewport.y = saveFile.viewport.y;\r\n\r\n          game.fs.setFolder(game.slot, true);\r\n\r\n          game.grid.reset();\r\n\r\n          \r\n\r\n          game.session = new GameSession(game);\r\n\r\n          game.ui.mainUI();\r\n\r\n          game.grid.loadFirstChunk((saveFile.viewport.x\/64)\/10, (saveFile.viewport.y\/64)\/10);\r\n        }, 5000);*\/\r\n\r\n      });\r\n    }\r\n\r\n  } else {\r\n    \/\/Not load, must be new or overwrite\r\n\r\n    var btn = game.render.component('hud_button', { name: title });\r\n    container.addChild(btn);\r\n    btn.x = w - btn.width - 50;\r\n    btn.y = 9;\r\n    btn.isInteractive();\r\n    btn.options = options;\r\n    btn.on('pointerup', function () {\r\n      game.index.getIndex('open_components')['frontMenu'].destroy();\r\n      game.ee.emit('newgame-clicked', this.options);\r\n    });\r\n\r\n  }\r\n\r\n  return pane;\r\n\r\n}"
    }
}