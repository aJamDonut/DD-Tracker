{
    "name": "Hud Bench Crafting",
    "codename": "hud_bench_crafting",
    "value": "0",
    "quantity": "0",
    "credits_shop_item": "0",
    "type": "component_widgets",
    "color": null,
    "editedtime": null,
    "vars": {
        "options": "'crafter'",
        "getElement": "function(options) {\r\n  \r\n  if(!options) {\r\n\toptions = {};\r\n  }\r\n  \r\n  let crafter = options.crafter;\r\n  \r\n  if(!crafter) {\r\n\tcrafter = new ComplexItem('pers_worlditem_craftingbench');\r\n    crafter.data.recipeList = 'player';\r\n    crafter.onCreate();\r\n  }\r\n  var knownRecipes = game.session.getUnlockedRecipes(crafter.data.recipeList) || [\r\n    'pickaxe'\r\n  ];\r\n  \r\n  game.crafting = {}\r\n  \r\n  var allRecipes = {};\r\n  \r\n  allRecipes = game.session.getUnlockedRecipesList(crafter.data.recipeList);\r\n\r\n  console.log(allRecipes);\r\n\r\n  var w = 390;\r\n  var h = 480;\r\n  var outer = new UIContainer();\r\n  \r\n  var pane = game.render.componentRaw('drawBoxPane', {title:'Workbench', moveable: true, showX: true, w: w, h: h+50});\r\n  pane.x = 500;\r\n  outer.addChild(pane);\r\n  var container = new UIContainer();\r\n  pane.addChild(container);\r\n  \r\n  container.x = 30;\r\n  container.y = 30;\r\n  \r\n  var listX = -30;\r\n  \r\n  crafter.knownRecipes = knownRecipes;\r\n  crafter.allRecipes = allRecipes;\r\n  \r\n  crafter.genRecipe = function(crafter, recipeName, recipe) {\r\n\tvar component = game.render.component('component_blueprint', {name: recipeName, recipe: _BLUEPRINTS.RECIPES['recipe_'+recipeName]});\r\n    \tcomponent.isInteractive();\r\n      component.recipe = recipe;\r\n      component.recipeName = recipeName;\r\n      component.crafter = crafter;\r\n      component.on('pointerup', function() {\r\n        console.log(\"Selet\", this.recipeName);\r\n        if(this.crafter.selected == this.recipeName) {\r\n\t\t\tthis.crafter.selected = false;\r\n          \treturn;\r\n        }\r\n          this.crafter.selected = this.recipeName;\r\n          this.crafter.recipe = this.recipe;\r\n      });\r\n      if(crafter.selected !== recipeName) {\r\n\t\tcomponent.alpha = 0.5;\r\n      }\r\n      return component;\r\n  }\r\n  \r\n  var column = new TickerContainer(crafter, function(crafter){   \r\n    let page = 1;\r\n\r\n                                   \r\n    if(this.pager && this.pager.pages) {\r\n      page = this.pager.pages.page;\r\n    }\r\n    \r\n    let list = [];\r\n    \r\n    for(let i = 0; i < crafter.knownRecipes.length; i++) {\r\n      list.push(crafter.genRecipe(crafter, crafter.knownRecipes[i], crafter.allRecipes[crafter.knownRecipes[i]]));\r\n    }\r\n\r\n    this.pane = new UIPane({fullscreen:false, fill: '0x303030', padding:0, x: -10, y: 5, w: 350, h:h-55});\r\n    let pager = game.render.componentRaw('pager', {template: 'pagergrid', ticks: true, page: page, width:340, items:list, itemsPerPage:4*4});\r\n  \t\r\n    pager.x = -5\r\n    pager.y = 10;\r\n    this.pager = pager;\r\n    this.pane.addChild(pager)\r\n   \r\n    this.addChild(this.pane);\r\n    \r\n  }, function(){\r\n  \tlet crafter = this.ref;\r\n    let refresh = (this.lastRecipe === crafter.recipe);\r\n    this.lastRecipe = crafter.recipe;\r\n    return refresh;\r\n  });\r\n  column.lastRecipe = 'whatever';\r\n  container.addChild(column);\r\n\r\n\r\n\tlet btnCraft = new TickerContainer(crafter, function(crafter){\r\n      \t\r\n      \tlet alpha = 1;\r\n      \r\n      \tif(!crafter.selected || crafter.selected.length == 0) {\r\n\t\t\talpha = 0.25;\r\n        }\r\n      \r\n      \t\r\n      \tlet title = 'Craft item';\r\n    \r\n      \tlet btnCraft = game.render.component('hud_button', {name:title, w: 150});\r\n      \t\r\n      \tbtnCraft.alpha = alpha;\r\n      \tthis.addChild(btnCraft);\r\n      \tbtnCraft.crafter = crafter;\r\n      \r\n      \tif(alpha !== 1) {\r\n\t\t\treturn;\r\n        }\r\n      \r\n      \tif(alpha == 1) {\r\n      \t\tbtnCraft.isInteractive();\r\n        }\r\n      \tbtnCraft.on('pointerup', function() {\r\n          console.log(\"Add for\", this.crafter.recipe, this.crafter);\r\n          this.crafter.queue.addItem(this.crafter.recipe);\r\n        });\r\n    \t\r\n    }, 0.05);\r\n  \r\n\tcontainer.addChild(btnCraft);\r\n\tbtnCraft.x = w - 200;\r\n    btnCraft.y = h - 40;\r\n  \r\n  \tlet btnInventory = game.render.component('hud_button', {name:'Inventory', w: 150});\r\n    pane.addChild(btnInventory);\r\n  \tbtnInventory.x = 20;\r\n  \tbtnInventory.y = btnCraft.y + 30;\r\n  \tbtnInventory.crafter = crafter;\r\n    btnInventory.on('pointerup', function() {\r\n      this.crafter.showInventory();\r\n    });\r\n\r\n\r\n  \tlet queuePane = game.render.componentRaw('drawBoxPane', {title:'Queue', moveable: true, showX: false, w: w + 90, h: h+10});\r\n\tqueuePane.x -= 500;\r\n    queuePane.y = 0;\r\n\r\n    let queue = game.render.componentRaw('component_list_queue', crafter);\r\n  \tqueuePane.addChild(queue);\r\n    queue.x = 20;\r\n  \tqueue.y = 20;\r\n    pane.addChild(queuePane);\r\n  \r\n\r\n  return outer;\r\n  \r\n}"
    }
}